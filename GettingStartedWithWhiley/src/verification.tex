\newpage
\section{Verification}

As discussed in the introduction, an important feature of Whiley is
{\em verification}.  That is made up of two aspects: firstly, the
ability to write specifications for functions and methods in Whiley;
secondly, the ability of the compiler to check the body of a function
or method meets its specification.

Unfortunately, specifications is not always straightforward and
requires considerable attention to detail.  Nevertheless, with
practice, it can easily fit into the routine of day-to-day
development.  In this section, we'll explore the basics of
verification in Whiley using some small examples.  In the following
section, we'll look at a larger and more example.

\subsection{Loop Invariants}

To complete our implementation of the \lstinline{indexOf()} function,
we need to add some hints to help the Whiley compiler.  These are
called {\em loop invariants}.  A loop invariant is a property which
holds before and after each iteration of the loop.  There are three
key points about loop invariants:
\begin{enumerate}
\item The loop invariant must hold on entry to the loop.
\item Assuming the loop invariant holds at the start of the loop body
  (along with the condition), it must hold at the end.
\item The loop invariant (along with the negated condition) can be
  assumed to hold immediately after the loop.
\end{enumerate}

To illustrate these three aspects, we'll use some simple loop
examples.  For example, consider the following example:

\begin{lstlisting}
function f(int x) => (int y)
// return cannot be negative
ensures y >= 0:
    //
    i = 0
    while i < x where i > 0:
        i = i + 1 
    //
    return i
\end{lstlisting}

Loop invariants in Whiley are indicated by the \lstinline{where}
clause.  Thus, in the above example, the loop invariant is
``\lstinline{i > 0}''.  Compiling the above program with verification
enabled will fail with an error.   This is because the loop invariant
does not hold on entry to the loop (item 1 above).